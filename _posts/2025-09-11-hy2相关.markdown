---
layout:     post
title:      "hy2相关记录"
date:       2025-09-11
author:     "suhiymof"
header-img: "img/hy2相关-bg-2025.jpg"
tags:
    - 魔法
    - hy2
---

## 安装hy2
- 命令 `bash <(curl -fsSL https://get.hy2.sh/)`

    在我的小破龟壳上输出如下
    ```
    63: note: SELinux is detected
    63: warning: Failed to obtain SEContext of /etc/systemd/system
    Checking for installed version ... not installed
    Checking for latest version ... v2.6.2
    Downloading hysteria binary: https://github.com/apernet/hysteria/releases/download/app/v2.6.2/hysteria-linux-amd64 ...
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                    Dload  Upload   Total   Spent    Left  Speed
    0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
    100 18.8M  100 18.8M    0     0  6167k      0  0:00:03  0:00:03 --:--:-- 5466k
    Installing hysteria executable ... ok
    Install /etc/hysteria/config.yaml ... ok
    Creating user hysteria ... ok
    Install /etc/systemd/system/hysteria-server.service ... ok
    Install /etc/systemd/system/hysteria-server@.service ... ok

    Congratulation! Hysteria 2 has been successfully installed on your server.

    What's next?

            + Take a look at the differences between Hysteria 2 and Hysteria 1 at https://hysteria.network/docs/misc/2-vs-1/
            + Check out the quick server config guide at https://hysteria.network/docs/getting-started/Server/
            + Edit server config file at /etc/hysteria/config.yaml
            + Start your hysteria server with systemctl start hysteria-server.service
            + Configure hysteria start on system boot with systemctl enable hysteria-server.service
    ```
- 具体查看 [生成自签证书](https://suhiymof.github.io/2025/09/11/hy2-生成自签证书/)

    ```
    openssl req -x509 -nodes -newkey ec:<(openssl ecparam -name prime256v1) -keyout /etc/hysteria/server.key -out /etc/hysteria/server.crt -subj "/CN=bing.com" -days 36500 && sudo chown hysteria /etc/hysteria/server.key && sudo chown hysteria /etc/hysteria/server.crt
    ```

- `config.yaml` 配置如下(这里用的自签证书)

    ```yaml
    listen: :443                # 默认监听443，可换成其它端口

    tls:
        cert: /etc/hysteria/server.crt
        key: /etc/hysteria/server.key
        sniGuard: strict  # 我设置了这个没起作用，不知道是哪里错了  
    # 关于sniGuard 官方解释如下：
        # 验证客户端发送的 SNI。 与证书信息匹配时才建立连接， 否则终止 TLS 握手。
        # 设置为 strict 以启用该功能。
        # 设置为 disable 以禁用该功能。
        # 默认为 dns-san， 仅当证书中包含「证书主题背景的备用名称」扩展且该扩展中包含域名时才启用该功能。

    quic:
        initStreamReceiveWindow: 26843545 
        maxStreamReceiveWindow: 26843545 
        initConnReceiveWindow: 67108864 
        maxConnReceiveWindow: 67108864 
    
    auth:
    type: password
    password: 123456 # 你的密码


    bandwidth:
    up: 50 mbps
    down: 50 mbps
    
    masquerade:
    type: proxy
    proxy:
        url: https://bing.com
        rewriteHost: true

    # trafficStats:
    #   listen: :1234567 # 流量查看端口
    ```
- 端口跳跃可看 [hy2端口跳跃设置](https://suhiymof.github.io/2025/09/11/hy2-端口跳跃/)

- 配置好服务端后，即可启动服务端：

    `systemctl start hysteria-server.service`

- 将服务端设置成开机自动启动

    `systemctl enable hysteria-server.service`

- 查看服务端状态：

    `systemctl status hysteria-server.service`

- 查询服务端日志

    `journalctl --no-pager -e -u hysteria-server.service`